---
layout: post
title: Mysql-数据库常问知识点总结(三)
categories: 数据库相关
description: Mysql-数据库常问知识点总结(三)
keywords: 数据库
---
### Mysql 和 redis 高可用性 

- MySQL Replication 是 MySQL 官方提供的主从同步方案， 用于将一个 MySQL 实例的数据， 同步到另一个实例中。 Replication 为保证数据安全做了重要的保证， 也是现在运用最广的 MySQL 容灾方案。Replication 用两个或以上的实例搭建了 MySQL 主从复制集群， 提供单点写入， 多点读取的服务， 实现了读的 scale out.
- Sentinel 是 Redis 官方为集群提供的高可用解决方案。 在实际项目中可以使用 sentinel 去做 redis 自动故障转移， 减少人工介入的工作量。 另外 sentinel 也给客户端提供了监控消息的通知， 这样客户端就可根据消息类型去判断服务器的状态， 去做对应的适配操作。

**下面是 Sentinel 主要功能列表：**

- Monitoring： Sentinel 持续检查集群中的 master、 slave 状态，判断是否存活。
- Notification： 在发现某个 redis 实例死的情况下， Sentinel能通过 API 通知系统管理员或其他程序脚本。Automatic failover： 如果一个 master 挂掉后， sentinel 立马启动故障转移， 把某个 slave 提升为 master。 其他的 slave 重新配置指向新 master。
- Configuration provider： 对于客户端来说 sentinel 通知是有效可信赖的。 客户端会连接 sentinel 去请求当前 master 的地址， 一旦发生故障 sentinel 会提供新地址给客户端。

### Redis和MongoDB的优缺点

MongoDB 和 Redis 都是 NoSQL， 采用结构型数据存储。 二者在使用场景中， 存在一定的区别， 这也主要由于二者在内存映射的处理过程， 持久化的处理方法不同。 MongoDB 建议集群部署， 更多的考虑到集群方案，Redis 更偏重于进程顺序写入， 虽然支持集群， 也仅限于主-从模式.
**Redis 优点：**

- 读写性能优异
- 支持数据持久化， 支持 AOF 和 RDB 两种持久化方式
- 支持主从复制， 主机会自动将数据同步到从机， 可以进行读写分离。
- 数据结构丰富： 除了支持 string 类型的 value 外还支持string、 hash、 set、 sortedset、 list 等数据结构。

**Redis缺点：**

- Redis 不具备自动容错和恢复功能， 主机从机的宕机都会导致前端部分读写请求失败， 需要等待机器重启或者手动切换前端的 IP才能恢复。
- 主机宕机， 宕机前有部分数据未能及时同步到从机， 切换 IP后还会引入数据不一致的问题， 降低了系统的可用性。
- Redis 的主从复制采用全量复制， 复制过程中主机会 fork 出一个子进程对内存做一份快照， 并将子进程的内存快照保存为文件发送给从机， 这一过程需要确保主机有足够多的空余内存。 若快照文件较大， 对集群的服务能力会产生较大的影响， 而且复制过程是在从机新加入集群或者从机和主机网络断开重连时都会进行， 也就是网络波动都会造成主机和从机间的一次全量的数据复制， 这对实际的系统运营造成了不小的麻烦。
- Redis 较难支持在线扩容， 在集群容量达到上限时在线扩容会变得很复杂。 为避免这一问题， 运维人员在系统上线时必须确保有足够的空间， 这对资源造成了很大的浪费。

**MongoDB优点:**

- 弱一致性（最终一致） ， 更能保证用户的访问速度文档结构的存储方式， 能够更便捷的获取数内置 GridFS， 高效存储二进制大对象 (比如照片和视频)
- 支持复制集、 主备、 互为主备、 自动分片等特性
- 动态查询
- 全索引支持,扩展到内部对象和内嵌数组

**MongoDB缺点：**

- 不支持事务
- MongoDB 占用空间过大
- 维护工具不够成熟

### 数据库负载均衡

负载均衡集群是由一组相互独立的计算机系统构成，通过常规网络或专用网络进行连接， 由路由器衔接在一起， 各节点相互协作、 共同负载、 均衡压力， 对客户端来说， 整个群集可以视为一台具有超高性能的独立服务器。

#### 1、 实现原理

实现数据库的负载均衡技术，首先要有一个可以控制连接数据库的控制端。 在这里， 它截断了数据库和程序的直接连接， 由所有的程序来访问这个中间层， 然后再由中间层来访问数据库。 这样， 我们就可以具体控制访问某个数据库了，然后还可以根据数据库的当前负载采取有效的均衡策略， 来调整每次连接到哪个数据库。

#### 2、 实现多据库数据同步

对于负载均衡，最重要的就是所有服务器的数据都是实时同步的。这是一个集群所必需的， 因为， 如果数不据实时、 不同步， 那么用户从一台服务器读出的数据， 就有别于从另一台服务器读出的数据， 这是不能允许的。 所以必须实现数据库的数据同步。 这样， 在查询的时候就可以有多个资源， 实现均衡。比较常用的方法是 Moebius for SQL Server 集群， Moebius for SQL Server 集群采用将核心程序驻留在每个机器的数据库中的办法， 这个核心程序称为 Moebius for SQL Server 中间件， 主要作用是监测数据库内数据的变化并将变化的数据同步到其他数据库中。 数据同步完成后客户端才会得到响应， 同步过程是并发完成的，所以同步到多个数据库和同步到一个数据库的时间基本相等； 另外同步的过程是在事务的环境下完成的， 保证了多份数据在任何时刻数据的一致性。 正因为 Moebius 中间件宿主在数据库中的创新， 让中间件不但能知道数据的变化， 而且知道引起数据变化的 SQL 语句，根据 SQL 语句的类型智能的采取不同的数据同步的策略以保证数据同步成本的最小化。数据条数很少， 数据内容也不大， 则直接同步数据数据条数很少， 但是里面包含大数据类型， 比如文本， 二进制数
据等， 则先对数据进行压缩然后再同步， 从而减少网络带宽的占用和传输所用的时间。数据条数很多，此时中间件会拿到造成数据变化的 SQL 语句， 然后对 SQL 语句进行解析， 分析其执行计划和执行成本， 并选择是同步数据还是同步 SQL 语句到其他的数据库中。此种情况应用在对表结构进行调整或者批量更改数据的时候非常有用。

#### 3、 优缺点优点：

**优点：**

- (1) 扩展性强： 当系统要更高数据库处理速度时， 只要简单地增加数据库服务器就 可以得到扩展。
- (2) 可维护性： 当某节点发生故障时， 系统会自动检测故障并转移故障节点的应用， 保证数据库的持续工作。
- (3) 安全性： 因为数据会同步的多台服务器上， 可以实现数据集的冗余， 通过多份数据来保证安全性。 另外它成功地将数据库放到了内网之中， 更好地保护了数据库的安全性。
- (4) 易用性： 对应用来说完全透明， 集群暴露出来的就是一个IP

**缺点：**

- (1) 不能够按照 Web 服务器的处理能力分配负载。
- (2) 负载均衡器(控制端)故障， 会导致整个数据库系统瘫痪。

